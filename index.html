<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Article and Preposition Trainer</title>
	<style>
		html, body {
			height: 100%;
			margin: 0;
			font-family: sans-serif;
			background-color: #f8f8f8;
			display: flex;
			flex-direction: column;
		}
		#inputArea, #outputArea {
			flex: 1;
			width: 90%;
			max-width: 600px;
			margin: 0 auto;
			display: flex;
			flex-direction: column;
			overflow: auto;
		}
		#inputArea {
			margin-top: 1em;
		}
		textarea {
			flex: 1;
			width: 100%;
			padding: 8px;
			font-size: 14px;
			border: 1px solid #ccc;
			box-sizing: border-box;
			resize: none;
		}

		#outputText {
			flex: 1;
			height: 90vh;
			overflow-y: auto;
			white-space: pre-wrap;
			word-wrap: break-word;
			border: 1px solid #ccc;
			background: white;
			padding: 8px;
			box-sizing: border-box;
			margin-top: 8px;
		}

		button {
			margin: 6px 4px;
			padding: 6px 10px;
			font-size: 14px;
			cursor: pointer;
		}

		.sentence {
			display: flex;
			justify-content: space-between;
			display: block;
			border: 1px solid #ccc;
			background-color: #f5f5f5;
			margin-bottom: 1em;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
			padding: 1em; /* Add padding so content doesn't touch edges */
			border-radius: 4px; /* Optional: soften corners */
		}

		.word-visible {
			color: black;
			background: none;
			border: none;
			font: inherit;
			<!-- cursor: pointer; -->
			padding: 0 2px;
			margin: 0;
		}

		.word-hidden {
			color: #666;
			background: #dadada;
			border-radius: 3px;
			padding: 0 4px;
			font-style: italic;
		}

		.word-hidden.article {
			background: #F2F2F2;
		}

		.word-hidden.preposition {
			background: #f9f5d7;
		}

		@media (max-width: 600px) {
			textarea, #outputText {
				font-size: 16px;
			}
		}

		.hidden {
			display: none !important;
		}

	</style>
</head>
<body>
	<div id="inputArea">
		<textarea id="inputText" placeholder="Paste German text here..."></textarea>
		<div>
			<button id="submitBtn">Submit</button>
			<button id="clearBtn">Clear</button>
		</div>
	</div>

	<div id="outputArea">
		<div id="outputText"></div>
		<div id="Control Pannel">
			<button id="resetBtn">Reset</button>
		</div>
	</div>

	<script>
		const body = document.getElementById('body');
		const inputArea = document.getElementById('inputArea');
		const inputText = document.getElementById('inputText');
		const submitBtn = document.getElementById('submitBtn');
		const clearBtn = document.getElementById('clearBtn');

		const outputArea = document.getElementById('outputArea');
		const outputText = document.getElementById('outputText');
		const resetBtn = document.getElementById('resetBtn');

		outputArea.classList.add('hidden');

		const sets = new Map([
			["Definitive article", {
				words: new Set(["der", "die", "das", "dem", "den", "des"]),
				className: "article"
			}],
			["Indefinitive article", {
				words: new Set(["ein", "eine", "einen", "einem", "einer", "eines"]),
				className: "article"
			}],
			["Negative article", {
				words: new Set(["kein", "keine", "keinen", "keiner"]),
				className: "article"
			}],
			["Akkusative preposition", {
				words: new Set(["durch", "für", "gegen", "ohne", "um", "bis", "entlang"]),
				className: "preposition"
			}],
			["Dative preposition", {
				words: new Set(["aus", "bei", "mit", "nach", "seit", "von", "zu", "gegenüber", "außer"]),
				className: "preposition"
			}],
			["Genitive preposition", {
				words: new Set(["während", "wegen", "trotz", "statt", "anstatt", "außerhalb", "innerhalb", "oberhalb", "unterhalb", "diesseits", "jenseits", "unweit", "angesichts", "aufgrund", "infolge"]),
				className: "preposition"
			}],
			["Akkusative/Dative preposition", {
				words: new Set(["an", "auf", "hinter", "in", "neben", "über", "unter", "vor", "zwischen"]),
				className: "preposition"
			}]
		]);

		inputText.addEventListener('input', () => {
			localStorage.setItem('input', inputText.value);
		})

		window.addEventListener('load', () => {
			const saved_input = localStorage.getItem('input');
			if (saved_input) {
				inputText.value = saved_input;
			}
		});

		submitBtn.addEventListener('click', () => {
			const text = inputText.value.trim();
			if (!text) {
				event.preventDefault();
				alert("Please enter a text for processing!");
				return ;
			}

			const sentenceSeg = new Intl.Segmenter('de', { granularity: 'sentence' });
			const sentences = Array.from(sentenceSeg.segment(text), s => s.segment);

			sentences.forEach(sentence => {
				const sentenceDiv = document.createElement("div");
				sentenceDiv.classList.add("sentence");
				const rawWords = sentence.split(/\s+/);

				rawWords.forEach(word => {
					const btn = document.createElement("button");
					btn.textContent = word;

					let matchedCategory = null;
					let categoryClass = null;
					for (const [category, { words: setWords, className }] of sets.entries()) {
						if (setWords.has(word.toLowerCase().replace(/^[^\w]+|[^\w]+$/g, ''))) {
							matchedCategory = category;
							categoryClass = className;
							break;
						}
					}

					if (matchedCategory) {
						btn.textContent = categoryClass.slice(0, 3);
						btn.classList.add("word-hidden", categoryClass);
						btn.addEventListener("click", function handleClick() {
							btn.textContent = word;
							btn.classList.remove("word-hidden");
							btn.classList.add("word-visible");
							btn.removeEventListener("click", handleClick);
						});
					} else if (word === ' ') {
						return;
					} else {
						btn.textContent = word;
						btn.classList.add("word-visible");
						btn.addEventListener("click", async function translateText() {
							if ('Translator' in self) {
								console.log("in translator");
								const translator = await Translator.create({
									sourceLanguage: "de",
									targetLanguage: "en"
								});
								const translation = await translator.translate(btn.textContent);
								console.log(translation);
								alert(translation);
							}
						});

					}
					sentenceDiv.appendChild(btn);
				});
				outputText.appendChild(sentenceDiv);
			});

			localStorage.setItem("output", outputText.innerHTML);
			outputArea.classList.remove('hidden');
			inputArea.classList.add('hidden');
		});

		clearBtn.addEventListener('click', () => {
			inputText.value = '';
		});

		resetBtn.addEventListener('click', () => {
			outputText.replaceChildren();
			outputArea.classList.add('hidden');
			inputArea.classList.remove('hidden');
		})
	</script>
</body>
</html>
